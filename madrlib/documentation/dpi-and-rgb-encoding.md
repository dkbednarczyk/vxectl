# VXE Mouse HID Protocol: DPI & RGB Encoding

## Preface

A couple hours deep into investigating these packets, I discovered on accident
that you could change the color of a DPI profile in the [web config tool](https://v3-hub.atk.store/).
My reaction was along the lines of "oh if you click the circle it lets you change
the col- THAT SENDS DATA TO THE MOUSE?" I think it's really stupid that the *mouse*
stores the RGB data for a given DPI profile instead of ATK just using a cookie in
your browser for something that does not affect the usage of the mouse whatsoever.
Discovering that already a few hours into an LLM-assisted reverse engineering
session was... disheartening to say the least.

**Disclaimer**: anything past this preface is mostly generated by Opus 4.5 after
I used it to help me decipher the relevant Wireshark logs and is therefore also
not guaranteed to be 100% correct.

## Overview

The mouse uses 17-byte HID feature reports to configure DPI and RGB settings.
Each packet configures **two stages** at once.

## Packet Structure

| Index | Name | Description |
|-------|------|-------------|
| 0-1 | Header | Always `08 07` |
| 2-3 | Reserved | Always `00 00` |
| 4 | Packet ID | Identifies packet type and stage pair |
| 5 | Length | Always `08` |
| 6-9 | Stage A | First stage data (3 bytes) + checksum |
| 10-13 | Stage B | Second stage data (3 bytes) + checksum |
| 14-15 | Reserved | Always `00 00` |
| 16 | End Checksum | `0x94 - packet_id` |

## Packet IDs

### DPI Packets

Formula: `0x04 + (packet_index * 0x08)`

| Packet Index | Packet ID | Stages |
|--------------|-----------|--------|
| 1 | `0x0C` | 1 + 2 |
| 2 | `0x14` | 3 + 4 |
| 3 | `0x1C` | 5 + 6 |
| 4 | `0x24` | 7 + 8 |

### RGB Packets

Formula: `0x24 + (packet_index * 0x08)`

| Packet Index | Packet ID | Stages |
|--------------|-----------|--------|
| 1 | `0x2C` | 1 + 2 |
| 2 | `0x34` | 3 + 4 |
| 3 | `0x3C` | 5 + 6 |
| 4 | `0x44` | 7 + 8 |

---

## DPI Encoding

### Supported Range

- Minimum: 100 DPI
- Maximum: 30000 DPI
- Increment: 50 DPI

### Value Calculation
`raw_value = (dpi / 50) - 1`

| DPI | Raw Value | Hex |
|-----|-----------|-----|
| 100 | 1 | `0x0001` |
| 800 | 15 | `0x000F` |
| 1600 | 31 | `0x001F` |
| 3200 | 63 | `0x003F` |
| 10000 | 199 | `0x00C7` |
| 30000 | 599 | `0x0257` |

### Byte Layout (per stage, 4 bytes)

| Byte | Content |
|------|---------|
| 0 | X DPI low byte |
| 1 | Y DPI low byte |
| 2 | High byte container |
| 3 | Checksum |

### High Byte Container

Packs the high bytes of both X and Y DPI values:
`high_container = (y_high << 6) | (x_high << 2)`

| Bits | Content |
|------|---------|
| 7-6 | Y DPI high byte (2 bits) |
| 5-4 | Unused |
| 3-2 | X DPI high byte (2 bits) |
| 1-0 | Unused |

### DPI Checksum
`checksum = 0x55 - x_low - y_low - high_container  (wrapping subtraction)`

### Example: 1600x1600 DPI
```
raw_value = (1600 / 50) - 1 = 31 = 0x001F

x_low  = 0x1F
y_low  = 0x1F
x_high = 0x00
y_high = 0x00

high_container = (0x00 << 6) | (0x00 << 2) = 0x00
checksum = 0x55 - 0x1F - 0x1F - 0x00 = 0x17

Encoded bytes: 1F 1F 00 17
```

### Example: 10000x10000 DPI
```
raw_value = (10000 / 50) - 1 = 199 = 0x00C7

x_low  = 0xC7
y_low  = 0xC7
x_high = 0x00
y_high = 0x00

high_container = 0x00
checksum = 0x55 - 0xC7 - 0xC7 - 0x00 = 0xC7  (wrapping)

Encoded bytes: C7 C7 00 C7
```

### Example: 15000x15000 DPI
```
raw_value = (15000 / 50) - 1 = 299 = 0x012B

x_low  = 0x2B
y_low  = 0x2B
x_high = 0x01
y_high = 0x01

high_container = (0x01 << 6) | (0x01 << 2) = 0x44
checksum = 0x55 - 0x2B - 0x2B - 0x44 = 0xBB  (wrapping)

Encoded bytes: 2B 2B 44 BB
```

---

## RGB Encoding

### Byte Layout (per stage, 4 bytes)

| Byte | Content |
|------|---------|
| 0 | Red (0-255) |
| 1 | Green (0-255) |
| 2 | Blue (0-255) |
| 3 | Checksum |

### RGB Checksum
`checksum = 0x55 - R - G - B  (wrapping subtraction)`

### Examples

| Color | RGB | Checksum | Encoded |
|-------|-----|----------|---------|
| Red | (255, 0, 0) | `0x55 - 0xFF = 0x56` | `FF 00 00 56` |
| Green | (0, 255, 0) | `0x55 - 0xFF = 0x56` | `00 FF 00 56` |
| Blue | (0, 0, 255) | `0x55 - 0xFF = 0x56` | `00 00 FF 56` |
| Yellow | (255, 255, 0) | `0x55 - 0xFF - 0xFF = 0x57` | `FF FF 00 57` |
| Magenta | (255, 0, 255) | `0x55 - 0xFF - 0xFF = 0x57` | `FF 00 FF 57` |
| White | (255, 255, 255) | `0x55 - 0xFF - 0xFF - 0xFF = 0x58` | `FF FF FF 58` |

---

## Complete Packet Examples

### DPI Packet: Stages 1+2 at 800 DPI
```
Stage 1: 800 DPI symmetric → 0F 0F 00 37
Stage 2: 800 DPI symmetric → 0F 0F 00 37
Packet ID: 0x0C
End checksum: 0x94 - 0x0C = 0x88

Packet: 08 07 00 00 0C 08 0F 0F 00 37 0F 0F 00 37 00 00 88
```

### RGB Packet: Stages 1+2 (Red + Green)
```
Stage 1: Red (255, 0, 0) → FF 00 00 56
Stage 2: Green (0, 255, 0) → 00 FF 00 56
Packet ID: 0x2C
End checksum: 0x94 - 0x2C = 0x68

Packet: 08 07 00 00 2C 08 FF 00 00 56 00 FF 00 56 00 00 68
```

---

## Packet Sequence

To fully configure 4 DPI stages:

1. DPI Packet 1 (`0x0C`): Stages 1 + 2
2. DPI Packet 2 (`0x14`): Stages 3 + 4
3. RGB Packet 1 (`0x2C`): Stages 1 + 2
4. RGB Packet 2 (`0x34`): Stages 3 + 4

**Note:** A delay of ~50ms between packets is required for reliable operation.